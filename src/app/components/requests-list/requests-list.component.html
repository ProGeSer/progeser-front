<ng-template #cancelableRequestActions let-request="request">
  <button (click)="cancelRequest(request)"
          *ngIf="!request.isInCancelation() && !request.isCanceled()"
          mat-icon-button
          [matTooltip]="'phrases.cancelTheRequest'|translate"
          matTooltipPosition="after">
    <mat-icon>cancel</mat-icon>
  </button>

  <button (click)="deleteRequest(request)"
          *ngIf="request.isCanceled() && userIsGrower()"
          [matTooltip]="'phrases.deleteTheRequest'|translate"
          mat-icon-button
          matTooltipPosition="after">
    <mat-icon>delete</mat-icon>
  </button>
</ng-template>

<table [dataSource]="requests" mat-table>
  <ng-container matColumnDef="plant">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.plant'|translate }}</th>
    <td *matCellDef="let request" mat-cell>{{ request.plantName }}</td>
  </ng-container>

  <ng-container matColumnDef="dueDate">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.dueDate'|translate }}</th>
    <td mat-cell *matCellDef="let request">{{ request.dueDate.toLocaleDateString(translateService.currentLang) }}</td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.name'|translate }}</th>
    <td mat-cell *matCellDef="let request">{{ request.name }}</td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.status'|translate }}</th>
    <td *matCellDef="let request" mat-cell>{{ translateService.instant('words.requestStatus.' + request.status) }}</td>
  </ng-container>

  <ng-container matColumnDef="creationDate">
    <th mat-header-cell *matHeaderCellDef>{{ 'phrases.creationDate'|translate }}</th>
    <td mat-cell *matCellDef="let request">{{ request.createdAt.toLocaleDateString(translateService.currentLang) }}</td>
  </ng-container>

  <ng-container matColumnDef="growerActions">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.actions'|translate }}</th>
    <td mat-cell *matCellDef="let request">
      <a [matTooltip]="'phrases.seeDetails'|translate"
         [routerLink]="['/manage-request/', request.id, 'see']"
         mat-icon-button
         matTooltipPosition="after">
        <mat-icon>visibility</mat-icon>
      </a>

      <ng-container *ngIf="request.isPending()">
        <button (click)="acceptRequest(request)"
                mat-icon-button
                [matTooltip]="'phrases.acceptTheRequest'|translate"
                matTooltipPosition="after">
          <mat-icon>done</mat-icon>
        </button>
        <button (click)="rejectRequest(request)"
                mat-icon-button
                [matTooltip]="'phrases.rejectTheRequest'|translate"

                matTooltipPosition="after">
          <mat-icon>clear</mat-icon>
        </button>
      </ng-container>

      <ng-container *ngIf="!request.isPending()">
        <ng-container *ngTemplateOutlet="cancelableRequestActions; context: {request: request}"></ng-container>
      </ng-container>
    </td>
  </ng-container>

  <ng-container matColumnDef="requesterActions">
    <th mat-header-cell *matHeaderCellDef>{{ 'words.actions'|translate }}</th>
    <td mat-cell *matCellDef="let request">
      <button mat-icon-button
              [matTooltip]="'phrases.modifyTheRequest'|translate"
              matTooltipPosition="after">
        <mat-icon>create</mat-icon>
      </button>

      <ng-container *ngTemplateOutlet="cancelableRequestActions; context: {request: request}"></ng-container>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columns"></tr>
  <tr mat-row *matRowDef="let row; columns: columns;"></tr>
</table>

<app-paginator #requestsPaginator [fetcher]="httpRequestService" [filters]="filters"></app-paginator>
